{% extends "base.html" %}
{% load static %}

{% block title %}{{ client.name }} · Partner Outreach — Demo{% endblock %}

{% block extra_head %}
<style>
  .demo-outreach .card-partner {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    border: 1px solid #eee;
  }
  .demo-outreach .card-partner:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .demo-outreach .badge {
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.2rem 0.5rem;
    border-radius: 6px;
  }
  .demo-outreach .badge-top { background: #DBEAFE; color: #1E40AF; }
  .demo-outreach .badge-active { background: #D1FAE5; color: #065F46; }
  .demo-outreach .badge-verify { background: #FEF3C7; color: #92400E; }
  .demo-outreach .badge-linkedin { background: #E0E7FF; color: #3730A3; }
  .demo-outreach .badge-networking { background: #F3E8FF; color: #5B21B6; }
  .demo-outreach .badge-high { background: #FCE7F3; color: #9D174D; }
  .demo-outreach .detail-block {
    overflow: hidden;
    transition: max-height 0.3s ease;
  }
</style>
{% endblock %}

{% block content %}
<div class="demo-outreach max-w-4xl mx-auto px-6 py-10" x-data="demoOutreach()">
  <!-- Header -->
  <header class="mb-8">
    <h1 class="text-xl font-semibold text-apple-gray-600">
      {{ client.name }} · Partner Outreach
    </h1>
    <p class="mt-1 text-sm text-apple-gray-400">
      {{ client.name }} · {{ client.updated }} · <a href="{{ client.profile_url }}" class="text-apple-blue hover:underline">View Details</a>
    </p>
    <div class="mt-4 flex flex-wrap items-center gap-4">
      <span class="text-sm font-medium text-apple-gray-600">
        <span x-text="contactedCount">0</span>/{{ partners|length }} partners contacted
      </span>
      <button type="button"
              @click="resetProgress()"
              class="text-sm text-apple-blue hover:underline focus:outline-none">
        Reset Progress
      </button>
    </div>
  </header>

  <!-- Ready to Contact -->
  <section class="mb-10">
    <h2 class="text-base font-semibold text-apple-gray-600 mb-1">
      Ready to Contact <span class="font-normal text-apple-gray-400">({{ partners_ready|length }})</span>
    </h2>
    <p class="text-xs text-apple-gray-400 mb-4">Direct emails verified</p>
    <div class="space-y-4">
      {% for partner in partners_ready %}
      <div class="card-partner p-4" x-data="{ open: false }">
        <div class="flex flex-wrap items-start justify-between gap-2">
          <div class="min-w-0 flex-1">
            <p class="font-medium text-apple-gray-600">{{ partner.name }}</p>
            <p class="text-sm text-apple-gray-400">{{ partner.company }} · {{ partner.tagline }}</p>
          </div>
          <div class="flex items-center gap-2 flex-shrink-0">
            {% if partner.badge %}
            <span class="badge {% if partner.badge == 'Top Match' %}badge-top{% elif partner.badge == 'Active JV' %}badge-active{% elif partner.badge == 'Networking' %}badge-networking{% else %}badge-top{% endif %}">{{ partner.badge }}</span>
            {% endif %}
            <span class="text-xs text-apple-gray-400">{{ partner.list_size }} List</span>
          </div>
        </div>
        <button type="button"
                @click="open = !open"
                class="mt-3 text-xs text-apple-blue hover:underline focus:outline-none">
          tap for details
        </button>
        <div class="detail-block mt-3 border-t border-apple-gray-100 pt-3" x-show="open" x-transition>
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm">
            {% if partner.email %}
            <dt class="text-apple-gray-400">Email</dt>
            <dd><a href="mailto:{{ partner.email }}" class="text-apple-blue hover:underline">{{ partner.email }}</a></dd>
            {% endif %}
            {% if partner.website %}
            <dt class="text-apple-gray-400">Website</dt>
            <dd><a href="{{ partner.website }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">{{ partner.website }}</a></dd>
            {% endif %}
            {% if partner.phone %}
            <dt class="text-apple-gray-400">Phone</dt>
            <dd>{{ partner.phone }}</dd>
            {% endif %}
            {% if partner.linkedin %}
            <dt class="text-apple-gray-400">LinkedIn</dt>
            <dd><a href="{{ partner.linkedin }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">View Profile</a></dd>
            {% endif %}
            {% if partner.pr_contact %}
            <dt class="text-apple-gray-400">PR / best contact</dt>
            <dd>{{ partner.pr_contact }}</dd>
            {% endif %}
            {% if partner.schedule %}
            <dt class="text-apple-gray-400">Schedule</dt>
            <dd><a href="{{ partner.schedule }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">Book</a></dd>
            {% endif %}
            <dt class="text-apple-gray-400">Niche</dt>
            <dd>{{ partner.niche }}</dd>
          </dl>
          <div class="mt-3">
            <p class="text-xs font-medium text-apple-gray-400">Why fit</p>
            <div class="mt-1 text-sm text-apple-gray-600 space-y-1">
              {% for line in partner.why_fit %}
              <p>{{ line }}</p>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Needs Verification -->
  <section class="mb-10">
    <h2 class="text-base font-semibold text-apple-gray-600 mb-1">
      Needs Verification <span class="font-normal text-apple-gray-400">({{ partners_verify|length }})</span>
    </h2>
    <p class="text-xs text-apple-gray-400 mb-4">Verify contact before reaching out</p>
    <div class="space-y-4">
      {% for partner in partners_verify %}
      <div class="card-partner p-4" x-data="{ open: false }">
        <div class="flex flex-wrap items-start justify-between gap-2">
          <div class="min-w-0 flex-1">
            <p class="font-medium text-apple-gray-600">{{ partner.name }}</p>
            <p class="text-sm text-apple-gray-400">{{ partner.company }} · {{ partner.tagline }}</p>
          </div>
          <div class="flex items-center gap-2 flex-shrink-0">
            {% if partner.badge %}
            <span class="badge badge-verify">{{ partner.badge }}</span>
            {% endif %}
            <span class="text-xs text-apple-gray-400">{{ partner.list_size }} List</span>
          </div>
        </div>
        <button type="button"
                @click="open = !open"
                class="mt-3 text-xs text-apple-blue hover:underline focus:outline-none">
          tap for details
        </button>
        <div class="detail-block mt-3 border-t border-apple-gray-100 pt-3" x-show="open" x-transition>
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm">
            {% if partner.email %}
            <dt class="text-apple-gray-400">Email</dt>
            <dd><a href="mailto:{{ partner.email }}" class="text-apple-blue hover:underline">{{ partner.email }}</a></dd>
            {% endif %}
            {% if partner.website %}
            <dt class="text-apple-gray-400">Website</dt>
            <dd><a href="{{ partner.website }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">{{ partner.website }}</a></dd>
            {% endif %}
            {% if partner.phone %}
            <dt class="text-apple-gray-400">Phone</dt>
            <dd>{{ partner.phone }}</dd>
            {% endif %}
            {% if partner.linkedin %}
            <dt class="text-apple-gray-400">LinkedIn</dt>
            <dd><a href="{{ partner.linkedin }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">View Profile</a></dd>
            {% endif %}
            {% if partner.schedule %}
            <dt class="text-apple-gray-400">Schedule</dt>
            <dd><a href="{{ partner.schedule }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">Book</a></dd>
            {% endif %}
            <dt class="text-apple-gray-400">Niche</dt>
            <dd>{{ partner.niche }}</dd>
          </dl>
          <div class="mt-3">
            <p class="text-xs font-medium text-apple-gray-400">Why fit</p>
            <div class="mt-1 text-sm text-apple-gray-600 space-y-1">
              {% for line in partner.why_fit %}
              <p>{{ line }}</p>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- LinkedIn Outreach -->
  <section class="mb-10">
    <h2 class="text-base font-semibold text-apple-gray-600 mb-1">
      LinkedIn Outreach <span class="font-normal text-apple-gray-400">({{ partners_linkedin|length }})</span>
    </h2>
    <p class="text-xs text-apple-gray-400 mb-4">No email — connect via LinkedIn</p>
    <div class="space-y-4">
      {% for partner in partners_linkedin %}
      <div class="card-partner p-4" x-data="{ open: false }">
        <div class="flex flex-wrap items-start justify-between gap-2">
          <div class="min-w-0 flex-1">
            <p class="font-medium text-apple-gray-600">{{ partner.name }}</p>
            <p class="text-sm text-apple-gray-400">{{ partner.company }} · {{ partner.tagline }}</p>
          </div>
          <div class="flex items-center gap-2 flex-shrink-0">
            {% if partner.badge %}
            <span class="badge {% if partner.badge == '1M+ Reach' %}badge-linkedin{% else %}badge-high{% endif %}">{{ partner.badge }}</span>
            {% endif %}
            <span class="text-xs text-apple-gray-400">{{ partner.list_size }}</span>
          </div>
        </div>
        <button type="button"
                @click="open = !open"
                class="mt-3 text-xs text-apple-blue hover:underline focus:outline-none">
          tap for details
        </button>
        <div class="detail-block mt-3 border-t border-apple-gray-100 pt-3" x-show="open" x-transition>
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm">
            {% if partner.linkedin %}
            <dt class="text-apple-gray-400">LinkedIn</dt>
            <dd><a href="{{ partner.linkedin }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">View Profile</a></dd>
            {% endif %}
            {% if partner.website %}
            <dt class="text-apple-gray-400">Website</dt>
            <dd><a href="{{ partner.website }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">{{ partner.website }}</a></dd>
            {% endif %}
            {% if partner.schedule %}
            <dt class="text-apple-gray-400">Calendar</dt>
            <dd><a href="{{ partner.schedule }}" target="_blank" rel="noopener" class="text-apple-blue hover:underline">Book</a></dd>
            {% endif %}
            <dt class="text-apple-gray-400">Niche</dt>
            <dd>{{ partner.niche }}</dd>
          </dl>
          <div class="mt-3">
            <p class="text-xs font-medium text-apple-gray-400">Why fit</p>
            <div class="mt-1 text-sm text-apple-gray-600 space-y-1">
              {% for line in partner.why_fit %}
              <p>{{ line }}</p>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-t border-apple-gray-200 pt-6 flex flex-wrap items-center gap-4">
    <a href="{{ client.profile_url }}" class="text-sm text-apple-blue hover:underline">{{ client.name }} · Client Profile</a>
    <span class="text-apple-gray-300">·</span>
    <a href="{{ client.website }}" target="_blank" rel="noopener" class="text-sm text-apple-gray-500 hover:underline">{{ client.website }}</a>
    <div class="w-full sm:w-auto sm:ml-auto flex gap-3 mt-2 sm:mt-0">
      <button type="button"
              @click="copyOutreachEmail()"
              class="px-4 py-2 text-sm font-medium rounded-lg bg-apple-gray-100 text-apple-gray-600 hover:bg-apple-gray-200 focus:outline-none">
        Copy Outreach Email
      </button>
      <button type="button"
              @click="copyFollowUp()"
              class="px-4 py-2 text-sm font-medium rounded-lg bg-apple-gray-100 text-apple-gray-600 hover:bg-apple-gray-200 focus:outline-none">
        Copy Follow-up
      </button>
      <button type="button"
              @click="templateOpen = true"
              class="px-4 py-2 text-sm font-medium rounded-lg bg-apple-gray-100 text-apple-gray-600 hover:bg-apple-gray-200 focus:outline-none">
        Template
      </button>
    </div>
  </footer>

  <!-- Template modal -->
  <div x-show="templateOpen"
       x-cloak
       class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40"
       @keydown.escape.window="templateOpen = false">
    <div @click.away="templateOpen = false"
         class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[80vh] overflow-y-auto"
         role="dialog"
         aria-labelledby="template-title">
      <div class="flex justify-between items-center mb-4">
        <h3 id="template-title" class="text-lg font-semibold text-apple-gray-600">Email Template</h3>
        <button type="button"
                @click="templateOpen = false"
                class="p-2 rounded-lg hover:bg-apple-gray-100 text-apple-gray-500 focus:outline-none"
                aria-label="Close">
          &times;
        </button>
      </div>
      <div class="text-sm text-apple-gray-600 whitespace-pre-wrap mb-4" x-text="templateSample"></div>
      <button type="button"
              @click="copyTemplate(); templateOpen = false"
              class="w-full px-4 py-2 text-sm font-medium rounded-lg bg-apple-blue text-white hover:bg-blue-600 focus:outline-none">
        Copy to Clipboard
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('alpine:init', function() {
    Alpine.data('demoOutreach', function() {
      const total = {{ partners|length }};
      return {
        contactedCount: 0,
        templateOpen: false,
        templateSample: `Hi [Partner Name],

I'm reaching out from Once Upon a Time Partners. We help leaders and teams with premium events and transformations, and your work in [Niche] looks like a strong fit for our audience.

Would you be open to a short conversation to explore a potential JV or collaboration?

Best,
[Your name]`,
        resetProgress() {
          this.contactedCount = this.contactedCount === total ? 0 : total;
        },
        copyOutreachEmail() {
          const text = `Subject: Partnership idea – Once Upon a Time Partners\n\nHi [Name],\n\nI'd love to connect about a potential JV. Our audiences align around [topic]. Would you be open to a quick call?\n\nBest,\n[Your name]`;
          navigator.clipboard.writeText(text).then(() => alert('Outreach email copied to clipboard.'));
        },
        copyFollowUp() {
          const text = `Hi [Name],\n\nJust following up on my note below. Would love to find 15 minutes to explore a partnership.\n\nBest,\n[Your name]`;
          navigator.clipboard.writeText(text).then(() => alert('Follow-up copied to clipboard.'));
        },
        copyTemplate() {
          navigator.clipboard.writeText(this.templateSample).then(() => alert('Template copied to clipboard.'));
        }
      };
    });
  });
</script>
{% endblock %}
