<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report.company_name }} · Client Profile</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">
    {% if clarity_project_id %}<script type="text/javascript">(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window,document,"clarity","script","{{ clarity_project_id }}");</script>{% endif %}
    <style>
        :root { --cream: #faf8f5; --ink: #1a1a1a; --forest: #1e3a2f; --gold: #c9a962; --gold-light: #e8d5a8; --muted: #8b8680; --blush: #f4e8e1; --card: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--cream); color: var(--ink); line-height: 1.5; -webkit-font-smoothing: antialiased; min-height: 100vh; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.03; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); }
        .container { max-width: 820px; margin: 0 auto; padding: 24px 20px 80px; position: relative; }
        .header { text-align: center; padding: 32px 0 24px; border-bottom: 1px solid var(--gold-light); margin-bottom: 32px; }
        .hub-link { margin-bottom: 16px; font-size: 13px; }
        .hub-link a { color: var(--forest); text-decoration: underline; text-underline-offset: 2px; }
        .back-link { display: inline-block; font-size: 13px; color: var(--muted); text-decoration: none; margin-bottom: 12px; }
        .back-link:hover { color: var(--forest); text-decoration: underline; text-underline-offset: 2px; }
        .header-eyebrow { font-size: 11px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; }
        .header h1 { font-family: 'Playfair Display', Georgia, serif; font-size: 28px; font-weight: 500; color: var(--forest); letter-spacing: -0.02em; }
        .header-meta { margin-top: 12px; font-size: 13px; color: var(--muted); }
        .header-meta a { color: var(--forest); text-decoration: underline; text-underline-offset: 2px; }
        .main { margin-bottom: 2rem; }
        .client-card { background: var(--card); border-radius: 8px; padding: 1.25rem 1.5rem; margin-bottom: 1.25rem; box-shadow: 0 1px 3px rgba(0,0,0,0.04); display: flex; gap: 1rem; align-items: flex-start; }
        .client-avatar { width: 56px; height: 56px; background: var(--forest); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gold); font-weight: 600; font-size: 1.25rem; flex-shrink: 0; }
        .client-info h2 { font-family: 'Playfair Display', Georgia, serif; font-size: 1.125rem; font-weight: 500; color: var(--forest); }
        .client-company { color: var(--muted); font-size: 0.875rem; }
        .client-title { color: var(--ink); font-size: 0.8125rem; margin-top: 0.25rem; }
        .section { background: var(--card); border-radius: 8px; margin-bottom: 1.25rem; box-shadow: 0 1px 3px rgba(0,0,0,0.04); overflow: hidden; }
        .section-header { padding: 0.875rem 1.25rem; border-bottom: 1px solid var(--gold-light); background: var(--cream); }
        .section-title { font-family: 'Playfair Display', Georgia, serif; font-size: 16px; font-weight: 500; color: var(--forest); }
        .section-body { padding: 1.25rem; }
        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        @media (max-width: 480px) { .info-grid { grid-template-columns: 1fr; } }
        .info-item label { display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); margin-bottom: 0.25rem; }
        .info-item .value { font-weight: 600; font-size: 0.9375rem; color: var(--ink); }
        .info-item .sub { font-size: 0.75rem; color: var(--muted); }
        .info-item .highlight { color: var(--gold); }
        .info-item a { color: var(--forest); text-decoration: underline; text-underline-offset: 2px; }
        .commission-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        @media (max-width: 600px) { .commission-grid { grid-template-columns: repeat(2, 1fr); } }
        .commission-box { text-align: center; padding: 1rem; background: var(--blush); border-radius: 6px; }
        .commission-box.highlight { background: var(--forest); }
        .commission-value { font-size: 1.25rem; font-weight: 700; color: var(--ink); }
        .commission-box.highlight .commission-value { color: var(--gold); }
        .commission-label { font-size: 0.6875rem; color: var(--muted); margin-top: 0.25rem; }
        .commission-box.highlight .commission-label { color: var(--gold-light); }
        .text-block { font-size: 0.875rem; color: var(--ink); }
        .text-block p { margin-bottom: 1rem; }
        .text-block p:last-child { margin-bottom: 0; }
        .text-block strong { color: var(--forest); }
        .text-block ul { list-style: none; margin: 0.5rem 0; }
        .text-block li { padding: 0.25rem 0; padding-left: 1rem; position: relative; }
        .text-block li::before { content: "\2022"; position: absolute; left: 0; color: var(--gold); }
        .key-message { background: var(--forest); border-radius: 8px; padding: 2rem 2.5rem; margin-bottom: 1.25rem; }
        .key-message-label { font-size: 0.6875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gold-light); margin-bottom: 0.75rem; text-align: center; }
        .key-message-headline { font-family: 'Playfair Display', Georgia, serif; font-size: 1.375rem; font-weight: 500; color: var(--gold); text-align: center; margin-bottom: 1.25rem; line-height: 1.3; }
        .key-message-points { list-style: none; padding: 0; display: grid; gap: 0.625rem; }
        .key-message-points li { color: var(--gold-light); font-size: 0.9375rem; padding-left: 1.5rem; position: relative; line-height: 1.4; }
        .key-message-points li::before { content: "·"; position: absolute; left: 0.5rem; color: var(--gold); font-weight: 700; font-size: 1.25rem; line-height: 1.2; }
        .faq-item { border-bottom: 1px solid var(--blush); }
        .faq-item:last-child { border-bottom: none; }
        .faq-question { padding: 0.875rem 1.25rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-question:hover { background: var(--blush); }
        .faq-toggle { color: var(--gold); font-size: 0.75rem; }
        .faq-answer { display: none; padding: 0 1.25rem 0.875rem 1.25rem; font-size: 0.8125rem; color: var(--muted); }
        .faq-item.open .faq-answer { display: block; }
        .faq-item.open .faq-toggle { transform: rotate(180deg); }
        .contact-footer { background: var(--card); border-radius: 8px; padding: 1.25rem; text-align: center; font-size: 0.8125rem; color: var(--muted); margin-bottom: 1.25rem; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        .contact-footer a { color: var(--forest); text-decoration: underline; text-underline-offset: 2px; }
        .footer { border-top: 1px solid var(--gold-light); padding: 1.5rem; text-align: center; font-size: 0.75rem; color: var(--muted); }
        .footer a { color: var(--forest); text-decoration: underline; text-underline-offset: 2px; }
        .tier-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem; }
        @media (max-width: 600px) { .tier-grid { grid-template-columns: 1fr; } }
        .tier-box { padding: 1rem; background: var(--blush); border-radius: 6px; text-align: center; }
        .tier-box.highlight { background: var(--forest); color: white; }
        .tier-name { font-weight: 600; font-size: 0.875rem; margin-bottom: 0.5rem; }
        .tier-box.highlight .tier-name { color: var(--gold); }
        .tier-desc { font-size: 0.75rem; color: var(--muted); }
        .tier-box.highlight .tier-desc { color: var(--gold-light); }
    </style>
</head>
<body>
    <div class="container">
        {% if static_mode %}
        <p class="hub-link"><a href="index.html">&#8592; Partner report home</a></p>
        {% else %}
        <p class="hub-link"><a href="{% url 'matching:report-hub' report.id %}">&#8592; Partner report home</a></p>
        {% endif %}
        <header class="header">
            {% if not static_mode %}
            <a href="{% url 'matching:report-outreach' report.id %}" class="back-link">&#8592; Back to Partner Outreach</a>
            {% endif %}
            <div class="header-eyebrow">Client Profile</div>
            <h1>{% if static_mode %}{{ contact_name }}{% else %}{{ report.member_name }}{% endif %}</h1>
            <div class="header-meta">
                {% if static_mode %}
                {{ contact_name }}
                {% else %}
                {{ contact_name }} &middot; <a href="{% url 'matching:report-outreach' report.id %}">View Partner Outreach List</a>
                {% endif %}
            </div>
            {% if has_supabase_profile and not static_mode %}
            <div style="margin-top: 16px;">
                <a href="{% url 'matching:report-profile-edit' report.id %}" style="display: inline-block; padding: 0.5rem 1.25rem; background: var(--forest); color: var(--gold); border-radius: 6px; text-decoration: none; font-size: 0.8125rem; font-weight: 600; letter-spacing: 0.02em;">Edit Profile</a>
            </div>
            {% endif %}
        </header>

        {% if messages %}
        <div style="margin-bottom: 1.25rem;">
            {% for message in messages %}
            <div style="padding: 0.75rem 1rem; border-radius: 6px; font-size: 0.875rem; margin-bottom: 0.5rem; {% if message.tags == 'success' %}background: #e8f5e9; color: #1b5e20; border: 1px solid #c8e6c9;{% elif message.tags == 'info' %}background: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb;{% else %}background: #fde8e8; color: #c0392b; border: 1px solid #f5c6c6;{% endif %}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

        <main class="main">
            <!-- Client Card -->
            <div class="client-card">
                <div class="client-avatar">{{ avatar_initials }}</div>
                <div class="client-info">
                    <h2>{{ contact_name }}</h2>
                    <div class="client-company">{% if static_mode %}{{ company_name }}{% else %}{{ report.company_name }}{% endif %}</div>
                    <div class="client-title">{{ title }}</div>
                </div>
            </div>

            <!-- The Offer -->
            <div class="section">
                <div class="section-header"><span class="section-title">The Offer</span></div>
                <div class="section-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Current Program</label>
                            <div class="value">{{ program_name }}</div>
                            <div class="sub">{{ program_sub }}</div>
                        </div>
                        <div class="info-item">
                            <label>Program Focus</label>
                            <div class="value highlight">{{ program_focus }}</div>
                        </div>
                        <div class="info-item">
                            <label>Target Audience</label>
                            <div class="value">{{ target_audience }}</div>
                            <div class="sub">{{ target_audience_sub }}</div>
                        </div>
                        <div class="info-item">
                            <label>Network Reach</label>
                            <div class="value">{{ network_reach }}</div>
                            <div class="sub">{{ network_reach_sub }}</div>
                        </div>
                    </div>
                    {% if tiers %}
                    <div class="tier-grid">
                        {% for tier in tiers %}
                        <div class="tier-box {% if tier.highlight %}highlight{% endif %}">
                            <div class="tier-name">{{ tier.name }}</div>
                            <div class="tier-desc">{{ tier.desc }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if main_website %}
                    <div style="margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid #f0f0f0;">
                        <div class="info-item">
                            <label>Main Website</label>
                            <a href="{{ main_website }}" target="_blank" rel="noopener">{{ main_website }}</a>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- What Client Offers Partners -->
            {% if offers_partners %}
            <div class="section">
                <div class="section-header"><span class="section-title">What {% if static_mode %}{{ company_name }}{% else %}{{ report.company_name }}{% endif %} Offers Partners</span></div>
                <div class="section-body">
                    <div class="commission-grid">
                        {% for offer in offers_partners %}
                        <div class="commission-box {% if offer.highlight %}highlight{% endif %}">
                            <div class="commission-value">{{ offer.value }}</div>
                            <div class="commission-label">{{ offer.label }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% if partner_deliverables %}
                    <div class="text-block" style="margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid #f0f0f0;">
                        <p><strong>What You Get:</strong></p>
                        <ul>
                            {% for item in partner_deliverables %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    {% if why_converts %}
                    <div class="text-block" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #f0f0f0;">
                        <p><strong>Why This Offer Converts:</strong></p>
                        <ul>
                            {% for item in why_converts %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Proven Results -->
            {% if launch_stats %}
            <div class="section">
                <div class="section-header"><span class="section-title">Proven Results</span></div>
                <div class="section-body text-block">
                    {% if launch_stats.partner %}
                    <p style="color: var(--muted); font-size: 0.8125rem; margin-bottom: 0.75rem;">{{ launch_stats.partner }}{% if launch_stats.audience %} · {{ launch_stats.audience }}{% endif %}</p>
                    {% endif %}
                    {% if launch_stats.metrics %}
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        {% for m in launch_stats.metrics %}
                        <div style="padding: 0.5rem; background: var(--blush); border-radius: 4px;">
                            <div style="font-size: 0.6875rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.03em;">{{ m.label }}</div>
                            <div style="font-weight: 600; font-size: 0.9375rem;">{{ m.value }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Key Positioning Message -->
            {% if key_message_headline %}
            <div class="key-message">
                <div class="key-message-label">Key Positioning Message</div>
                <div class="key-message-headline">{{ key_message_headline }}</div>
                {% if key_message_points %}
                <ul class="key-message-points">
                    {% for point in key_message_points %}
                    <li>{{ point }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% elif key_message %}
            <div class="key-message">
                <div class="key-message-label">Key Positioning Message</div>
                <div class="key-message-headline">{{ key_message }}</div>
            </div>
            {% endif %}

            <!-- About Section -->
            <div class="section">
                <div class="section-header"><span class="section-title">About {{ contact_name }}</span></div>
                <div class="section-body text-block">
                    {% if about_story_paragraphs %}
                        {% for para in about_story_paragraphs %}
                        <p>{% if forloop.first %}<strong>The Story:</strong> {% endif %}{{ para }}</p>
                        {% endfor %}
                    {% elif about_story %}
                    <p><strong>The Story:</strong> {{ about_story }}</p>
                    {% endif %}
                    {% if shared_stage %}
                    <p><strong>Shared Stage With:</strong></p>
                    <ul>
                        {% for item in shared_stage %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if credentials %}
                    <p><strong>Credentials / Core Offers:</strong></p>
                    <ul>
                        {% for item in credentials %}
                        {% if item.name %}
                        <li><strong>{{ item.name }}</strong>{% if item.role %} ({{ item.role }}){% endif %}{% if item.desc %}: {{ item.desc }}{% endif %}</li>
                        {% else %}
                        <li>{{ item }}</li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>

            <!-- Resources & Proof -->
            {% if resource_links %}
            <div class="section">
                <div class="section-header"><span class="section-title">Resources &amp; Proof</span></div>
                <div class="section-body text-block">
                    <ul>
                        {% for link in resource_links %}
                        <li><a href="{{ link.url }}" target="_blank" rel="noopener">{{ link.label }}</a>{% if link.desc %} — {{ link.desc }}{% endif %}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}

            <!-- Ideal Partner Profile -->
            <div class="section">
                <div class="section-header"><span class="section-title">Ideal Partner Profile</span></div>
                <div class="section-body text-block">
                    {% if ideal_partner_intro %}
                    <p>{{ ideal_partner_intro|safe }}</p>
                    {% endif %}
                    {% if ideal_partner_sub %}
                    <p style="color: var(--muted);">{{ ideal_partner_sub }}</p>
                    {% endif %}
                    {% if perfect_for %}
                    <p><strong>Perfect For:</strong></p>
                    <ul>
                        {% for item in perfect_for %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>

            <!-- What Client Is Seeking -->
            {% if seeking_goals %}
            <div class="section">
                <div class="section-header"><span class="section-title">What {{ contact_name }} Is Seeking</span></div>
                <div class="section-body text-block">
                    <p><strong>JV Partnership Goals:</strong></p>
                    <ul>
                        {% for item in seeking_goals %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}

            <!-- Partner FAQs -->
            {% if faqs %}
            <div class="section">
                <div class="section-header"><span class="section-title">Partner FAQs</span></div>
                <div style="padding: 0;">
                    {% for faq in faqs %}
                    <div class="faq-item" onclick="this.classList.toggle('open'); if (typeof jvTrack !== 'undefined') jvTrack('faq_toggle', null, {faq_index: {{ forloop.counter0 }}, is_open: this.classList.contains('open')})">
                        <div class="faq-question">
                            {{ faq.q }}
                            <span class="faq-toggle">&#9660;</span>
                        </div>
                        <div class="faq-answer">{{ faq.a }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Confirm Profile -->
            {% if has_unconfirmed_edits and not static_mode %}
            <div class="section" style="border: 2px solid var(--gold); background: var(--blush);">
                <div class="section-header" style="background: var(--forest);">
                    <span class="section-title" style="color: var(--gold);">Confirm Your Profile</span>
                </div>
                <div class="section-body" style="text-align: center;">
                    <p style="font-size: 0.875rem; color: var(--ink); margin-bottom: 1rem;">You have unconfirmed profile changes. Confirming locks your data so it won't be overwritten by automated updates.</p>
                    <form method="post" action="{% url 'matching:report-profile-confirm' report.id %}">
                        {% csrf_token %}
                        <button type="submit" style="padding: 0.625rem 1.5rem; background: var(--forest); color: var(--gold); border: none; border-radius: 6px; font-family: 'DM Sans', sans-serif; font-size: 0.875rem; font-weight: 600; cursor: pointer; letter-spacing: 0.02em;">Confirm Profile</button>
                    </form>
                </div>
            </div>
            {% endif %}

            <!-- Contact Footer -->
            {% if contact_email %}
            <div class="contact-footer">
                <div>Questions or updates?</div>
                <a href="mailto:{{ contact_email }}">{{ contact_email }}</a>
            </div>
            {% endif %}
        </main>

        <div class="footer">
            {% if static_mode %}
            {{ company_name }} &middot; <a href="index.html">Partner report</a> &middot; Client Profile{% if main_website %} &middot; <a href="{{ main_website }}" target="_blank" rel="noopener">{{ main_website }}</a>{% endif %}
            {% else %}
            {{ report.company_name }} &middot; <a href="{% url 'matching:report-hub' report.id %}">Partner report</a> &middot; Client Profile &middot; <a href="{% url 'matching:report-outreach' report.id %}">Partner Outreach</a>{% if main_website %} &middot; <a href="{{ main_website }}" target="_blank" rel="noopener">{{ main_website }}</a>{% endif %}
            {% endif %}
        </div>
    </div>
    {% if tracking_config %}
    <script>
    (function() {
        'use strict';
        var CFG;
        try { CFG = JSON.parse('{{ tracking_config|escapejs }}'); } catch(e) { return; }
        if (!CFG.supabase_url || !CFG.supabase_anon_key) return;

        var ENDPOINT = CFG.supabase_url.replace(/\/+$/, '') + '/rest/v1/outreach_events';
        var sid = sessionStorage.getItem('jv_sid');
        if (!sid) {
            sid = 's_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
            sessionStorage.setItem('jv_sid', sid);
        }

        var queue = [];
        function flush() {
            if (queue.length === 0) return;
            var batch = queue.splice(0, 10);
            fetch(ENDPOINT, {
                method: 'POST',
                headers: {
                    'apikey': CFG.supabase_anon_key,
                    'Authorization': 'Bearer ' + CFG.supabase_anon_key,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify(batch),
                keepalive: true
            }).catch(function() {});
        }

        window.jvTrack = function(eventType, partnerId, details) {
            queue.push({
                report_id: CFG.report_id,
                access_code: CFG.access_code,
                event_type: eventType,
                partner_id: partnerId || null,
                details: details || {},
                session_id: sid
            });
            if (queue.length >= 10) flush();
        };

        setInterval(flush, 5000);

        var pageLoadTime = Date.now();
        jvTrack('page_load', null, {
            page_type: 'profile',
            referrer: document.referrer,
            viewport_width: window.innerWidth
        });

        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                jvTrack('page_exit', null, {
                    page_type: 'profile',
                    time_on_page_secs: Math.round((Date.now() - pageLoadTime) / 1000)
                });
                flush();
            }
        });
    })();
    </script>
    {% endif %}
</body>
</html>
